// DOM Elements
const screens = document.querySelectorAll('.screen');
const startBtn = document.getElementById('start-btn');
const progressBar = document.getElementById('progress');

// Question screens
const genderScreen = document.getElementById('gender-screen');
const genderNext = document.getElementById('gender-next');
const genderOptions = document.querySelectorAll('#gender-screen .option-card');

const skinToneScreen = document.getElementById('skin-tone-screen');
const skinToneNext = document.getElementById('skin-tone-next');
const skinToneBack = document.getElementById('skin-tone-back');
const skinToneOptions = document.querySelectorAll('#skin-tone-screen .option-card');

const bodyTypeScreen = document.getElementById('body-type-screen');
const bodyTypeNext = document.getElementById('body-type-next');
const bodyTypeBack = document.getElementById('body-type-back');
const bodyTypeOptions = document.getElementById('body-type-options');

const outfitTypeScreen = document.getElementById('outfit-type-screen');
const outfitTypeNext = document.getElementById('outfit-type-next');
const outfitTypeBack = document.getElementById('outfit-type-back');
const outfitTypeOptions = document.querySelectorAll('#outfit-type-screen .option-card');

const resultScreen = document.getElementById('result-screen');
const resultImage = document.getElementById('result-image');
const restartBtn = document.getElementById('restart-btn');

// User data
const userData = {
    gender: null,
    skinTone: null,
    bodyType: null,
    outfitType: null
};

// Body type options
const bodyTypes = {
    male: [
        { value: 'pear', label: 'Pear (Narrow shoulders, wider waist)' },
        { value: 'inverted_triangle', label: 'Inverted Triangle (Broad shoulders, narrow waist)' },
        { value: 'rectangle', label: 'Rectangle (Balanced proportions)' }
    ],
    female: [
        { value: 'pear', label: 'Pear (Narrow shoulders, wider hips)' },
        { value: 'apple', label: 'Apple (Wider midsection)' },
        { value: 'inverted_triangle', label: 'Inverted Triangle (Broad shoulders, narrow hips)' },
        { value: 'rectangle', label: 'Rectangle (Balanced proportions)' },
        { value: 'hourglass', label: 'Hourglass (Balanced shoulders/hips, narrow waist)' }
    ]
};

// Outfit images database
const outfitImages = {
    male: {
        light: {
            pear: {
                casual: 'https://images.unsplash.com/photo-1551232864-3f0890e580d9?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=687&q=80',
                formal: 'https://images.unsplash.com/photo-1593030761757-71fae45fa0e7?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=880&q=80'
            },
            inverted_triangle: {
                casual: 'https://images.unsplash.com/photo-1527719327859-c6ce80353573?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=764&q=80',
                formal: 'https://images.unsplash.com/photo-1622286342621-4bd786c2447c?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=687&q=80'
            },
            rectangle: {
                casual: 'https://images.unsplash.com/photo-1529374255404-311a2a4f1fd9?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=725&q=80',
                formal: 'https://images.unsplash.com/photo-1593030103066-0093718efeb9?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=880&q=80'
            }
        },
        medium: {
            pear: {
                casual: 'https://images.unsplash.com/photo-1527719327859-c6ce80353573?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=764&q=80',
                formal: 'https://images.unsplash.com/photo-1622286342621-4bd786c2447c?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=687&q=80'
            },
            inverted_triangle: {
                casual: 'https://images.unsplash.com/photo-1551232864-3f0890e580d9?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=687&q=80',
                formal: 'https://images.unsplash.com/photo-1593030761757-71fae45fa0e7?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=880&q=80'
            },
            rectangle: {
                casual: 'https://images.unsplash.com/photo-1529374255404-311a2a4f1fd9?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=725&q=80',
                formal: 'https://images.unsplash.com/photo-1593030103066-0093718efeb9?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=880&q=80'
            }
        },
        dark: {
            pear: {
                casual: 'https://images.unsplash.com/photo-1527719327859-c6ce80353573?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=764&q=80',
                formal: 'https://images.unsplash.com/photo-1622286342621-4bd786c2447c?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=687&q=80'
            },
            inverted_triangle: {
                casual: 'https://images.unsplash.com/photo-1551232864-3f0890e580d9?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=687&q=80',
                formal: 'https://images.unsplash.com/photo-1593030761757-71fae45fa0e7?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=880&q=80'
            },
            rectangle: {
                casual: 'https://images.unsplash.com/photo-1529374255404-311a2a4f1fd9?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=725&q=80',
                formal: 'https://images.unsplash.com/photo-1593030103066-0093718efeb9?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=880&q=80'
            }
        }
    },
    female: {
        light: {
            pear: {
                casual: 'https://images.unsplash.com/photo-1539109136881-3be0616acf4b?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=687&q=80',
                formal: 'https://images.unsplash.com/photo-1551232864-3f0890e580d9?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=687&q=80'
            },
            apple: {
                casual: 'https://images.unsplash.com/photo-1490114538077-0a7f8cb49891?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1470&q=80',
                formal: 'https://images.unsplash.com/photo-1581044777550-4cfa60707c03?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=686&q=80'
            },
            inverted_triangle: {
                casual: 'https://images.unsplash.com/photo-1525507119028-ed4c629a60a3?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=735&q=80',
                formal: 'https://images.unsplash.com/photo-1584917865442-de89df76afd3?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=735&q=80'
            },
            rectangle: {
                casual: 'https://images.unsplash.com/photo-1551232864-3f0890e580d9?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=687&q=80',
                formal: 'https://images.unsplash.com/photo-1581044777550-4cfa60707c03?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=686&q=80'
            },
            hourglass: {
                casual: 'https://images.unsplash.com/photo-1525507119028-ed4c629a60a3?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=735&q=80',
                formal: 'https://images.unsplash.com/photo-1584917865442-de89df76afd3?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=735&q=80'
            }
        },
        medium: {
            pear: {
                casual: 'https://images.unsplash.com/photo-1539109136881-3be0616acf4b?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=687&q=80',
                formal: 'https://images.unsplash.com/photo-1551232864-3f0890e580d9?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=687&q=80'
            },
            apple: {
                casual: 'https://images.unsplash.com/photo-1490114538077-0a7f8cb49891?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1470&q=80',
                formal: 'https://images.unsplash.com/photo-1581044777550-4cfa60707c03?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=686&q=80'
            },
            inverted_triangle: {
                casual: 'https://images.unsplash.com/photo-1525507119028-ed4c629a60a3?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=735&q=80',
                formal: 'https://images.unsplash.com/photo-1584917865442-de89df76afd3?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=735&q=80'
            },
            rectangle: {
                casual: 'https://images.unsplash.com/photo-1551232864-3f0890e580d9?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=687&q=80',
                formal: 'https://images.unsplash.com/photo-1581044777550-4cfa60707c03?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=686&q=80'
            },
            hourglass: {
                casual: 'https://images.unsplash.com/photo-1525507119028-ed4c629a60a3?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=735&q=80',
                formal: 'https://images.unsplash.com/photo-1584917865442-de89df76afd3?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=735&q=80'
            }
        },
        dark: {
            pear: {
                casual: 'https://images.unsplash.com/photo-1539109136881-3be0616acf4b?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=687&q=80',
                formal: 'https://images.unsplash.com/photo-1551232864-3f0890e580d9?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=687&q=80'
            },
            apple: {
                casual: 'https://images.unsplash.com/photo-1490114538077-0a7f8cb49891?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1470&q=80',
                formal: 'https://images.unsplash.com/photo-1581044777550-4cfa60707c03?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=686&q=80'
            },
            inverted_triangle: {
                casual: 'https://images.unsplash.com/photo-1525507119028-ed4c629a60a3?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=735&q=80',
                formal: 'https://images.unsplash.com/photo-1584917865442-de89df76afd3?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=735&q=80'
            },
            rectangle: {
                casual: 'https://images.unsplash.com/photo-1551232864-3f0890e580d9?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=687&q=80',
                formal: 'https://images.unsplash.com/photo-1581044777550-4cfa60707c03?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=686&q=80'
            },
            hourglass: {
                casual: 'https://images.unsplash.com/photo-1525507119028-ed4c629a60a3?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=735&q=80',
                formal: 'https://images.unsplash.com/photo-1584917865442-de89df76afd3?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=735&q=80'
            }
        }
    }
};

// Initialize the app
function init() {
    // Start button click event
    startBtn.addEventListener('click', () => {
        showScreen(genderScreen);
        updateProgress(20);
    });

    // Gender selection
    setupOptionSelection(genderOptions, genderNext, 'gender');

    // Gender next button
    genderNext.addEventListener('click', () => {
        showScreen(skinToneScreen);
        updateProgress(40);
    });

    // Skin tone selection
    setupOptionSelection(skinToneOptions, skinToneNext, 'skinTone');

    // Skin tone back button
    skinToneBack.addEventListener('click', () => {
        showScreen(genderScreen);
        updateProgress(20);
    });

    // Skin tone next button
    skinToneNext.addEventListener('click', () => {
        populateBodyTypeOptions();
        showScreen(bodyTypeScreen);
        updateProgress(60);
    });

    // Body type back button
    bodyTypeBack.addEventListener('click', () => {
        showScreen(skinToneScreen);
        updateProgress(40);
    });

    // Body type next button
    bodyTypeNext.addEventListener('click', () => {
        showScreen(outfitTypeScreen);
        updateProgress(80);
    });

    // Outfit type selection
    setupOptionSelection(outfitTypeOptions, outfitTypeNext, 'outfitType');

    // Outfit type back button
    outfitTypeBack.addEventListener('click', () => {
        showScreen(bodyTypeScreen);
        updateProgress(60);
    });

    // Outfit type next button (show results)
    outfitTypeNext.addEventListener('click', showResults);

    // Restart button
    restartBtn.addEventListener('click', restartApp);
}

// Helper function to set up option selection
function setupOptionSelection(options, nextButton, dataProperty) {
    options.forEach(option => {
        option.addEventListener('click', () => {
            // Remove selected class from all options
            options.forEach(opt => opt.classList.remove('selected'));
            
            // Add selected class to clicked option
            option.classList.add('selected');
            
            // Update user data
            userData[dataProperty] = option.dataset.value;
            
            // Enable next button
            nextButton.disabled = false;
        });
    });
}

// Populate body type options based on gender
function populateBodyTypeOptions() {
    bodyTypeOptions.innerHTML = '';
    const types = bodyTypes[userData.gender];
    
    types.forEach(type => {
        const option = document.createElement('div');
        option.className = 'option-card';
        option.dataset.value = type.value;
        option.textContent = type.label;
        bodyTypeOptions.appendChild(option);
        
        option.addEventListener('click', () => {
            document.querySelectorAll('#body-type-options .option-card').forEach(opt => {
                opt.classList.remove('selected');
            });
            option.classList.add('selected');
            userData.bodyType = option.dataset.value;
            bodyTypeNext.disabled = false;
        });
    });
}

// Show results with recommended outfit
function showResults() {
    const imageUrl = outfitImages[userData.gender][userData.skinTone][userData.bodyType][userData.outfitType];
    resultImage.src = imageUrl;
    resultImage.alt = `Recommended outfit for ${userData.gender} with ${userData.skinTone} skin tone and ${userData.bodyType} body type`;
    
    showScreen(resultScreen);
    updateProgress(100);
}

// Restart the application
function restartApp() {
    // Reset user data
    userData.gender = null;
    userData.skinTone = null;
    userData.bodyType = null;
    userData.outfitType = null;
    
    // Reset all selections
    document.querySelectorAll('.option-card.selected').forEach(option => {
        option.classList.remove('selected');
    });
    
    // Disable all next buttons
    genderNext.disabled = true;
    skinToneNext.disabled = true;
    bodyTypeNext.disabled = true;
    outfitTypeNext.disabled = true;
    
    // Show welcome screen
    showScreen(document.getElementById('welcome-screen'));
    updateProgress(0);
}

// Show a specific screen
function showScreen(screen) {
    screens.forEach(s => s.classList.remove('active'));
    screen.classList.add('active');
}

// Update progress bar
function updateProgress(percent) {
    progressBar.style.width = `${percent}%`;
}

// Initialize the application when DOM is loaded
document.addEventListener('DOMContentLoaded', init);